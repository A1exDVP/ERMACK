title: Изоляция хоста при помощи PT XDR
id: RAI3102_0001
linked_response_actions: RA3102
description: >
  Изоляция хоста через отключения сетевых адаптеров при помощи агента PT EDR
author: '@ERMACK_COMMUNITY'
creation_date: 2022/10/27
modification_date: 2022/10/27
stage: containment
linked_software:
  - S0002
  - S0003
tags:
  - isolate.host
linked_artifacts:
  - A1005
requirements:
  software:
    means_of_action:
    - ID: S0002
      cpe-fs: 'cpe:2.3:a:positive_technologies:pt_xdr:1.*:*:*:*:*:*:*:*'    
    targets_of_action:
    - ID: S0003
      cpe-fs: 'cpe:2.3:o:microsoft:windows:-:*:*:*:*:*:*:*'
extended_description: |

  ## Базовые параметры
  **Действие:** `PTEDR_ESC_Respond_Action_KillAdapters`
  **Модуль XDR:** `esc_host_isolator`

  ## Изоляция Windows хоста
  ### Запрос
  **Входные параметры:**
   - `timeout`: целочисленный параметр в миллисекундах. Влияет на время отключения сетевых адаптеров  
   - `ip`: строковый параметр, содержащий ipv4 эндпойнта, на котором нужно выполнить действие  

  ```json
  {"timeout": 60000, "ip": "10.125.124.7"}
  ```

  Логика работы:
  Запрос на отключение адаптеров кладется в очередь, которая мониторится раз в секунду. На очередной итерации начинается обработка запроса: находятся и отключаются все активные сетевые адаптеры (подробней описано здесь EDR, Изолировать устройство с проводным подключением), в очередь кладется задача на восстановление отключенных сетевых адаптеров, выжидается пауза размером с переданный timeout. На следующей итераици выполняется задача на включение ранее отключенных сетевых адаптеров.

  ### Ответ
  В случае успеха, пользователь получит сообщение:  
  ```json
  {
      "actions": [
          "esc_host_isolator.PTEDR_ESC_Respond_Action_KillAdapters"
      ],
      "status": "success",
      "data": {
          "reason": "action_exec_success",
          "timeout": 60000,
          "result": true,
          "ip": "10.125.124.7"
      }
  }
  ```
  ### Ограничения
  В случае, когда два и более запросов почти одновременно попали в очередь на обработку, запросы наложатся друг на друга. В таком случае адапетры будут отключены на время суммы всех таймаутов. Пример: пришло два запроса с таймаутами 10 минут и 1 минута. Суммарно адаптеры будут отключены на 11 минут.
  Сообщение, которое мы получаем в случае успеха говорит нам лишь о том, что задача на отключение адаптеров успешно попала в очередь задач. После отключения адаптеров у нас нет возможности вернуть что-либо заказчику действия. Возможным способом проверки успешности действия может быть ручная проверка сетевой достижимости, например через ping нужного эндпойнта.
